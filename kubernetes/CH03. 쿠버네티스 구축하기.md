## 클러스터 아키텍처
쿠버네티스는 여러 대의 서버가 하나의 클러스터로 연결되어있다.  
쿠버네티스 클러스터를 직접 구축하거나 구입할 때 어떤 옵션이 있는지 이해하려면 기본 컴포넌트를 이해하고 서로 어떻게 연동되는지 알아야 한다.  

- 컨트롤 플레인
클러스터의 두뇌 역할을 하며 컨테이너 스케줄링, 서비스 관리, API 요청 처리 등의 작업을 수행한다.  
컨트롤 플레인 컴포넌트는 클러스터 내 마스터 노드에서 실행된다.  
컨트롤 플레인은 다음과 같은 컴포넌트로 구성된다.  
1. kube-apiserver  
컨트롤 플레인의 프런트엔드 서버로 API 요청을 처리한다.  
2. etcd  
어떤 노드가 존재하고, 클러스터에 어떤 리소스가 존재하는지와 같은 쿠버네티스와 관련된 모든 정보를 저장하는 데이터베이스다.  
3. kube-scheduler  
새로 생성된 파드(Pod)를 실행할 노드를 결정한다.  
4. kube-controller-manager  
디플로이먼트와 같은 리소스 컨트롤러를 관리한다.  
5. cloud-controller-manager  
클라우드 기반 클러스터는 클라우드 업체와 연동하여 로드 밸런서나 디스크 볼륨과 같은 자원을 관리한다.  

- 노드 컴포넌트
워커 노드는 클러스터 내에서 사용자의 워크로드를 실행한다. 쿠버네티스 클러스터의 각 워커 노드는 다음과 같은 컴포넌트를 실행한다.  
1. kubelet  
노드에 예약된 워크로드를 실행하기 위해 컨테이너 런타임을 관리하고 상태를 모니터링한다.  
2. kube-proxy  
서로 다른 노드에 있는 파드 간 통신이나 파드와 인터넷 사이의 네트워크 트래픽을 라우팅한다.  
3. 컨테이너 런타임  
컨테이너를 시작하고 중지하며 컨테이너 간 통신을 처리한다.  
일반적으로 도커가 사용되지만 쿠버네티스는 rkt나 CRI-O와 같은 다른 컨테이너 런타임도 지원한다.  
서로 다른 소프트웨어 컴포넌트를 실행하는 것 외에는 마스터 노드와 워커 노드 사이에 본질적인 차이는 없다.  
도커 데스크톱이나 미니쿠브와 같이 클러스터 크기가 매우 작은 경우를 제외하고는 마스터 노드는 일반적으로 사용자 워크로드를 실행하지 않는다.

- 서로 다른 소프트웨어 컴포넌트를 실행하는 것 외에는 마스터 노드와 워커 노드 사이에 본질적인 차이는 없다.
- 도커 데스크톱이나 미니쿠브와 같이 클러스터 크기가 매우 작은 경우를 제외하고는 마스터 노드는 일반적으로 사용자 워크로드를 실행하지 않는다.

- 고가용성  
올바르게 구성된 쿠버네티스 컨트롤 플레인은 마스터 노드 여러개로 구성되어 고가용성을 보장한다.  
etcd 데이터베이스는 여러 노드에 걸쳐 복제된다. etcd 복제본의 절반 이상이 사용 가능한 상태라면 개별 etcd 노드 장애에도 고가용성을 보장한다.  

1. 컨트롤 플레인 장애  
예를 들어 클러스터의 모든 마스터 노드를 중단할 경우 워커 노드의 파드느느 한동안 계속 실행된다.  
그러나 새로운 컨테이너를 배포하거나 쿠버네티스 리소스를 변경할 수는 없으며 디플로이먼트와 같은 컨트롤러는 중지될 것이다.  
그러므로 컨트롤 플레인의 고가용성은 클러스터가 올바르게 작동하기 위해 매우 중요하다.  
상용 클러스터의 경우 마스터 노드가 최소 3개 필요하다.  

2. 워커 노드 장애  
반면 워커 노드의 장애는 별로 중요한 문제가 아니다.  
컨트롤 플레인이 작동하고 있다면 쿠버네티스가 워커 노드의 장애를 감지하고 해당 노드의 파드를 다른 노드로 재조정할 것이기 때문이다.  
→ 마스터 노드를 종료해도 모든 것이 정상적으로 작동하는지 확인 필요!  

- 자체 호스팅은 생각보다 어렵다.  
→ 단순히 퀍네티스를 설치/실행하는 것은 꽤 간단하다. 하지만 상용 서비스를 위한 수준의 클러스터를 준비하기까지는 많은 고려사항들이 있다.  
→ 클러스터는 안전하게 설정되어야 함. 내부 컴포넌트들은 TLS 암호화, 신뢰할 수 있는 인증서를 사용하여 통신.  
→ 사용자와 애플리케이션은 클러스터 작업을 위한 최소한의 권한을 가지고 있는지? 컨테이너 보안 기본값이 올바르게 설정되었는지?  
→ 노드가 컨트롤 플레인 컴포넌트에 불필요한 접근을 하는지? 내부 etcd 데이터베이스에 대한 접근은 적절하게 제어되고 인증되는지?  
→ 클러스터 노드가 셸 스크립트로 설치된 후 방치되지 않고 형상 관리되고 있는지? 등등  
→ 영구 스토리지를 포함하여 클러스터의 데이터가 제대로 백업되고 있는지? 복구 프로세스는? 복구 테스트는?  
- 쿠버네티스를 직업 구축/운영하는 것을 권장하지 않는다.(자체 호스팅X) 관리형 서비스를 사용하면 쿠버네티스를 자체 호스팅하는 것보다 훨씬 더 경제적이다.  

## 관리형 쿠버네티스 서비스
컨트롤 플레인과 같은 쿠버네티스 클러스터를 설치하고 운영하는 데 필요한 관리 비용을 모두 절감할 수 있다.  
1. 구글 쿠버네티스 엔진(GKE)  
구글 클라우드 사용하면 무조건 GKE로!  
쿠버네티스를 개발한 구글은 관리형 쿠버네티스 서비스인 GKE을 구글 클라우드 플랫폼(GCP)에 통합하여 제공한다.  
워커 노드의 개수를 지정한 뒤 GCP 웹 콘솔의 버튼을 클릭하거나 프로비저닝을 위한 배포 관리자 도구를 사용하면 몇분 이내에 사용 가능한 상태의 클러스터가 제공된다.  
컨트롤 플레인과 etcd에 대한 고가용성을 관리함. 클러스터 오토스케일링 기능을 제공함.  
→ 클러스터 오토스케일링  
2. 아마존 일래스틱 쿠버네티스 서비스 (EKS)  
GKE처럼 많은 기능 제공 X, 비싸다. 아마존이 구글과 마이크로소프트 애저의 서비스를 따라잡기에는 아직 부족.
3. 애저 쿠버네티스 서비스 (AKS)  
GKE, EKS와 마스터노드는 내부적으로 관리되기 때문에 직접 접근 X, 워커 노드 수를 기준으로 비용이 청구된다.
4. 오픈시프트  
서비스형 플랫폼(platform as a service, PaaS) 제품으로 관리형 쿠버네티스 서비스 이상의 역할을 한다.  
이것은 지속형 통합(CI)과 빌드 도구, 테스트 도구, 애플리케이션 배포, 모니터링, 오케스트레이션을 포함하여 전체 소프트웨어 개발 수명 주기를 관리하는 것을 목표로 한다.  
오픈시프트는 베어 메탈 서버, 가상 머신, 사설 클라우드, 퍼블릭 클라우드에 구축할 수 있어 모든 환경에서 단일 쿠버네티스 클러스터를 만들 수 있다.  
따라서 규모가 매우 크거나 다양한 인프라를 보유한 기업이라면 오픈시프트가 좋은 선택이 될 수 있다.  
5. IBM 클라우드 쿠버네티스 서비스  
매우 간단하고 직관적, IBM 클라우드를 사용하고 있다면 고려해볼만 함  
6. VM Ware PKS  
멀티 퍼블릭 클라우드에서 운영 중인 클러스터의 보안과 확장성을 원하는 대기업이라면 헵티오,,HKS는 BM웨어의 PKS 패키지에 통합되어 제공  

## 턴키형 쿠버네티스 솔루션 
- 웹 브라우저에서 버튼만 클릭하면 바로 사용 가능한 상용 쿠버네티스 클러스터 제공하는 것이 목표. 대기업/중소기업에게 모두 매력적  
1. 스택포인트  
클릭 세번으로 클러스터 배포가 가능, 자신의 퍼블릭 클라우드 인프라에서 워커 노드를 실행하고자 하는 기업에게 매력적인 솔루션  
2. 컨테이너십 쿠버네티스 엔진(CKE)  
퍼블릭 클라우드에서 쿠버네티스를 프로비저닝하기 위한 또 다른 웹 기반 인터페이스, 적절한 기본 값으로 구축, 사용자 지정 가능  
